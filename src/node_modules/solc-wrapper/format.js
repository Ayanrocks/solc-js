module.exports = format;

function getContractName(output) {
  let { contracts } = output;
  if (contracts) {
    var name = Object.keys(contracts)[0];
    if (name) {
      let metadata;
      if (name.indexOf(':') != -1) {
        return name;
      } else {
        return Object.keys(contracts[name])[0];
      }
    }
  }
  return;
}

function getMetadata(output) {
  let { contracts } = output;
  if (contracts) {
    var name = Object.keys(contracts)[0];
    if (name) {
      let metadata;
      if (name.indexOf(':') != -1) {
        metadata = contracts[name].metadata;
      } else {
        let name2 = Object.keys(contracts[name])[0];
        metadata = (contracts[name])[name2].metadata;
      }
      metadata = JSON.parse(metadata);
      // console.log('=== metadata ===');
      // console.log(metadata);
      return metadata;
    }
  }
}

function format(_output) {
  // console.log('output:');
  // console.log(_output);

  let output = {};
  output.contractName = getContractName(_output);
  output.success = output.contractName ? true : false;

  if (output.success) {
    output.metadata = getMetadata(_output);
    output.abi = output.metadata.output.abi;
    output.version = output.metadata.compiler.version;
  }
  
  output.errors = _output.errors;
  console.log('new output:');
  console.log(output);
  return output;
}