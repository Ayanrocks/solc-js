// //////////////////////////////////////////////////////////////////
// var Compiler = require('./src/compiler/compiler')
// var CompilerInput = require('./src/compiler/compiler-input')
// module.exports = { Compiler, CompilerInput }
// => Provides:
//
//     {
//         InternalCallTree: InternalCallTree,
//         SolidityProxy: SolidityProxy,
//         localDecoder: localDecoder,
//         stateDecoder: stateDecoder,
//         CodeAnalysis: CodeAnalysis
//     }
// //////////////////////////////////////////////////////////////////
const wrapper = require('./wrapper.js')
const format = require('./format.js')
// const solcABI = require('./abi.js')
// const CompilerImport = require('./handle-imports.js')

/******************************************************************************
  MODULE
******************************************************************************/
/*
  triggers
  - compilationFinished
  - compilerLoaded
  - compilationStarted
  - compilationDuration
*/
module.exports = compiler

function compiler (solc) {
  const _compiler = wrapper(solc)
  const api = {}

  Object.keys(_compiler).forEach(key => {
    if (key === 'compile') {
      api.compile = function (sourcecode) {
        // console.error(`[on:compile:start] solc.compile(sourcecode)`)
        var output = _compiler.compile(sourcecode, 1);
        var contracts = output.contracts
        return format(output);
        // return {
        //   "compiler": { "version": settings.compiler.version },
        //   "language": "Solidity",
        //   "output": {
        //     "abi": JSON.parse(abi)
        //   },
        //   "settings": ,
        //   "sources": {},
        //   "version": 1,
        // }
      }
    }
    else if (typeof _compiler[key] === 'function') api[key] = function (...args) {
      console.error(`compiler.${key}(...args)`, args)
      return _compiler[key].apply(_compiler, args)
    }
    else Object.defineProperty(api, key, {
      get () {
        var currentValue = _compiler[key]
        console.error(`compiler.${key} === `, currentValue)
        return currentValue
      },
      set (newValue) {
        console.error(`compiler.${key} = `, newValue)
        return _compiler[key] = newValue
      },
      enumerable: true,
      configurable: true
    })
  })
  return api
}
